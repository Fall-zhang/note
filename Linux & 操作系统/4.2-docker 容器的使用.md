> Create by **fall** on 28 Jun 2023
> Recently revised in 28 Jun 2023

## 实际上手

### postgres

拉取 postres

```bash
# 获取 15.3 版本的 postgres
docker pull postgres:15.3


# 运行镜像
docker run --name postgresql-standard --env POSTGRES_PASSWORD=996007aile --publish 9600:5432 postgres:15.3
# 创建一个专用卷用于数据库存储，实现数据持久性
# 
docker run --name database-postgres -e POSTGRES_PASSWORD=postgres -p 9600:5432 -v postgresvol:/var/lib/postgresql/data -d postgres:15.3
```

```lua

```



获取 postgresql

sameersbn/postgresql:12-20200524

```bash
docker run --name gitlab-postgresql -d --env DB_NAME=gitlabhq_production --env DB_USER=gitlab --env DB_PASS=admin_99565 --env DB_EXTENSION=pg_trgm,btree_gist --volume /srv/docker/gitlab/postgresql:/var/lib/postgresql  sameersbn/postgresql:12-20200524
```

获取 redis 

redis:6.2

```powershell
docker run --name gitlab-redis -d --volume /srv/docker/gitlab/redis:/data redis:6.2
```

使用 gitlab 容器

sameersbn/gitlab:16.0.5

```bash
docker run --name gitlab -d --link gitlab-postgresql:postgresql --link gitlab-redis:redisio --publish 7022:22 --publish 7080:80 --env GITLAB_PORT=7080 --env GITLAB_SSH_PORT=7022  --env GITLAB_SECRETS_DB_KEY_BASE=XGu6XUJ8x4QZ54OSMrvkKzeFHCqm1656Gb3yXZMzp3dJtm2ruio64ZllmtSgvt7pwnhp --env GITLAB_SECRETS_SECRET_KEY_BASE=ISidXCsUtdRRjaTzx7XOBE3rHNRF2qNNEgg9PfKeHSmEsXWfJueJv7M3NEVtUR2gBJAO --env GITLAB_SECRETS_OTP_KEY_BASE=K8KO33Ml85YM8ckm7fYoQyHAufYExMOKbR5jRzjtz8obhRFAsOuGvEy8p7NbneIjFIGC --volume /srv/docker/gitlab/gitlab:/home/git/data  sameersbn/gitlab:16.0.5
```

docker-compose

```yaml
version: '2.3'

services:
  redis:
    restart: always
    image: redis:6.2.6
    command:
    - --loglevel warning
    volumes:
    - redis-data:/data:Z

  postgresql:
    restart: always
    image: sameersbn/postgresql:12-20200524
    volumes:
    - postgresql-data:/var/lib/postgresql:Z
    environment:
    - DB_USER=gitlab
    - DB_PASS=password
    - DB_NAME=gitlabhq_production
    - DB_EXTENSION=pg_trgm,btree_gist

  gitlab:
    restart: always
    image: sameersbn/gitlab:16.0.5
    depends_on:
    - redis
    - postgresql
    ports:
    - "10080:80"
    - "10022:22"
    volumes:
    - gitlab-data:/home/git/data:Z
    healthcheck:
      test: ["CMD", "/usr/local/sbin/healthcheck"]
      interval: 5m
      timeout: 10s
      retries: 3
      start_period: 5m
    environment:
    - DEBUG=false

    - DB_ADAPTER=postgresql
    - DB_HOST=postgresql
    - DB_PORT=5432
    - DB_USER=gitlab
    - DB_PASS=password
    - DB_NAME=gitlabhq_production

    - REDIS_HOST=redis
    - REDIS_PORT=6379

    - TZ=Asia/Kolkata
    - GITLAB_TIMEZONE=Kolkata

    - GITLAB_HTTPS=false
    - SSL_SELF_SIGNED=false

    - GITLAB_HOST=localhost
    - GITLAB_PORT=10080
    - GITLAB_SSH_PORT=10022
    - GITLAB_RELATIVE_URL_ROOT=
    - GITLAB_SECRETS_DB_KEY_BASE=XGu6XUJ8x4QZ54OSMrvkKzeFHCqm1656Gb3yXZMzp3dJtm2ruio64ZllmtSgvt7pwnhp
    - GITLAB_SECRETS_SECRET_KEY_BASE=ISidXCsUtdRRjaTzx7XOBE3rHNRF2qNNEgg9PfKeHSmEsXWfJueJv7M3NEVtUR2gBJAO
    - GITLAB_SECRETS_OTP_KEY_BASE=K8KO33Ml85YM8ckm7fYoQyHAufYExMOKbR5jRzjtz8obhRFAsOuGvEy8p7NbneIjFIGC

    - GITLAB_ROOT_PASSWORD=
    - GITLAB_ROOT_EMAIL=

    - GITLAB_NOTIFY_ON_BROKEN_BUILDS=true
    - GITLAB_NOTIFY_PUSHER=false

    - GITLAB_EMAIL=notifications@example.com
    - GITLAB_EMAIL_REPLY_TO=noreply@example.com
    - GITLAB_INCOMING_EMAIL_ADDRESS=reply@example.com

    - GITLAB_BACKUP_SCHEDULE=daily
    - GITLAB_BACKUP_TIME=01:00

    - SMTP_ENABLED=false
    - SMTP_DOMAIN=www.example.com
    - SMTP_HOST=smtp.gmail.com
    - SMTP_PORT=587
    - SMTP_USER=mailer@example.com
    - SMTP_PASS=password
    - SMTP_STARTTLS=true
    - SMTP_AUTHENTICATION=login

    - IMAP_ENABLED=false
    - IMAP_HOST=imap.gmail.com
    - IMAP_PORT=993
    - IMAP_USER=mailer@example.com
    - IMAP_PASS=password
    - IMAP_SSL=true
    - IMAP_STARTTLS=false

    - OAUTH_ENABLED=false
    - OAUTH_AUTO_SIGN_IN_WITH_PROVIDER=
    - OAUTH_ALLOW_SSO=
    - OAUTH_BLOCK_AUTO_CREATED_USERS=true
    - OAUTH_AUTO_LINK_LDAP_USER=false
    - OAUTH_AUTO_LINK_SAML_USER=false
    - OAUTH_EXTERNAL_PROVIDERS=

    - OAUTH_CAS3_LABEL=cas3
    - OAUTH_CAS3_SERVER=
    - OAUTH_CAS3_DISABLE_SSL_VERIFICATION=false
    - OAUTH_CAS3_LOGIN_URL=/cas/login
    - OAUTH_CAS3_VALIDATE_URL=/cas/p3/serviceValidate
    - OAUTH_CAS3_LOGOUT_URL=/cas/logout

    - OAUTH_GOOGLE_API_KEY=
    - OAUTH_GOOGLE_APP_SECRET=
    - OAUTH_GOOGLE_RESTRICT_DOMAIN=

    - OAUTH_FACEBOOK_API_KEY=
    - OAUTH_FACEBOOK_APP_SECRET=

    - OAUTH_TWITTER_API_KEY=
    - OAUTH_TWITTER_APP_SECRET=

    - OAUTH_GITHUB_API_KEY=
    - OAUTH_GITHUB_APP_SECRET=
    - OAUTH_GITHUB_URL=
    - OAUTH_GITHUB_VERIFY_SSL=

    - OAUTH_GITLAB_API_KEY=
    - OAUTH_GITLAB_APP_SECRET=

    - OAUTH_BITBUCKET_API_KEY=
    - OAUTH_BITBUCKET_APP_SECRET=
    - OAUTH_BITBUCKET_URL=

    - OAUTH_SAML_ASSERTION_CONSUMER_SERVICE_URL=
    - OAUTH_SAML_IDP_CERT_FINGERPRINT=
    - OAUTH_SAML_IDP_SSO_TARGET_URL=
    - OAUTH_SAML_ISSUER=
    - OAUTH_SAML_LABEL="Our SAML Provider"
    - OAUTH_SAML_NAME_IDENTIFIER_FORMAT=urn:oasis:names:tc:SAML:2.0:nameid-format:transient
    - OAUTH_SAML_GROUPS_ATTRIBUTE=
    - OAUTH_SAML_EXTERNAL_GROUPS=
    - OAUTH_SAML_ATTRIBUTE_STATEMENTS_EMAIL=
    - OAUTH_SAML_ATTRIBUTE_STATEMENTS_NAME=
    - OAUTH_SAML_ATTRIBUTE_STATEMENTS_USERNAME=
    - OAUTH_SAML_ATTRIBUTE_STATEMENTS_FIRST_NAME=
    - OAUTH_SAML_ATTRIBUTE_STATEMENTS_LAST_NAME=

    - OAUTH_CROWD_SERVER_URL=
    - OAUTH_CROWD_APP_NAME=
    - OAUTH_CROWD_APP_PASSWORD=

    - OAUTH_AUTH0_CLIENT_ID=
    - OAUTH_AUTH0_CLIENT_SECRET=
    - OAUTH_AUTH0_DOMAIN=
    - OAUTH_AUTH0_SCOPE=

    - OAUTH_AZURE_API_KEY=
    - OAUTH_AZURE_API_SECRET=
    - OAUTH_AZURE_TENANT_ID=

volumes:
  redis-data:
  postgresql-data:
  gitlab-data:
```

## 参考文章

| 作者          | 文章名称                                                     |
| ------------- | ------------------------------------------------------------ |
| 爱笑的架构师  | [5分钟带你快速了解Docker和k8s](https://juejin.cn/post/6913568633813729294) |
| wljslmz       | [Docker小白的福音：50条Docker命令清单，干就完了！](https://juejin.cn/post/7127082572399509511) |
| Rain_or_Shine | [Docker 入门教程-阮一峰](https://juejin.cn/post/6844903561432662023) |
| 天行无忌      | [WEB开发人员应该知道 10 个 Docker 命令](https://juejin.cn/post/7188341548692537402) |
| 杨高超        | [通过 docker 搭建自用的 gitlab 服务](https://juejin.cn/post/6844903544496062472) |
|               |                                                              |

