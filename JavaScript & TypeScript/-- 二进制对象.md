---
sidebar_position: 7
---

> Create by **fall** on 2020----
> Recently revised in 2022-05-31

# 二进制对象

总共有五个大对象，`Blob`、`ArrayBuffer`、`File`、`FileReader`和 `FormData`

- Blob、ArrayBuffer、File可以归为一类，它们都是数据；
- FileReader算是一种工具，用来读取数据；
- FormData可以看做是一个应用数据的场景。

## Blob

Blob 全称是 `binary large object`，Blob 对象就是一个包含有只读原始数据的类文件对象，通俗讲就是不可修改的二进制文件。在数据库管理系统中，将二进制数据存储为一个单一个体的集合。Blob 通常是影像、声音或多媒体文件。

```js
// 创建一个 Blob 对象
// let aBlob = new Blob(blobParts,options);
// blobParts：ArrayBufferView + Blob + ArrayBuffer + DOMString 等对象构成的数组，其中 DOMString 会被编译为 utf-8
// options：一个可选对象，包含两个属性
// type：默认为 '' 表明放到 blob 中的数组内容的 MIME 类型
// endings：用于指定包含行结束符的 `n` 字符串如何被写入，默认为 "transparent"保持 blob 中的格式不变，可选为 "native"，代表行结束符，会被更改为适合宿主操作系统文件系统的换行符
let myBlob = new Blob(['Fall'],{type:'text/plain'})
// 此时 aBlob 是一个对象，拥有 size, type 两个属性。
myBlob.size// 4 用字节表示的数据大小（只读）
myBlob.type// 'text/plain' 表示 MIME 类型（只读）
```

> MIME：Multipurpose Internet Mail Extensions 多用途互联网邮件扩展类型

创建 Blob 对象

```js
let blobParts = ['<html><h2>Hello Semlinker</h2></html>']; // an array consisting of a single DOMString
let myBlob = new Blob(blobParts, {type : 'text/html'}); // the blob
console.log(myBlob.size + " bytes");
// 37 bytes
console.log("MIME type is "+myBlob.type);
// MIME type is text/html
let hello = new Uint8Array([72, 101, 108, 108, 111]) // 创建二进制格式的 hello
let blob = new Blob(['hello',' ','fall'],{type:'text/html'})
```

Blob 上面的方法

```js
// Blob 对象是不可改变的，但是可以通过 slice 进行分割
Blob.prototype.slice(start, end ,contentType)
//start：分割起始点 end：分割终点  contentType:新的MIME类型
Blob.prototype.stream()
// 返回一个能读取 Blob 内容的 ReadableStream
Blob.prototyoe.text()
// 返回一个 Promise 对象，且包含 blob 所有内容的
```

### 使用场景

分片上传：对于大文件的上传，通过slice 的方法对大文件进行切割，然后分片进行上传

```js
const file = new File(['a'.repeat(1000000)],'test.txt')
const chunkSize = 40000
const postUrl = 'https://example.web/post'
async function chunkUpload(){
  for(let start = 0;start<file.size;start+=chunkSize){
    const chunk = file.slice(start,start+chunkSize+1)
    const fd = new FormData()
    fd.append('data',chunk)
    await fetch(postUrl,{method:'post',body:fd}).then(res=>{
      res.text()
    })
  }
}
```

下载数据：可以将从互联网上下载的数据存放到 Blob 对象中

```js
// 使用 XMLHttpRequest
const downloadBlob = (url,callback)=>{
  const xhr = new XMLHttpRequest()
  xhr.open('GET',url)
  xhr.responseType = 'blob'
  xhr.onload=()=>{
    callback(xhr.response)
  }
  xhr.send(null)
}
// 使用 fetch
const myImg = document.querySelector('img')
const myReq = new Request('flowers.jpg')
fetch(myReq).then(res=>{
  return response.blob()
}).then(blob=>{
  let objURL = URL.createObjectURL(blob)
  myImage.src = objURL
})
```





## File

File 对象继承自 Blob，也是二进制对象，通常用在`<input type='file'>` 选择的 FileList 对象。或者是拖拽产生的`DataTransfer`对象。

```js
var oneFile = new File(array,name,options)
// array 数据构成的数组
// name 文件名
// options 设置一些属性，Type属性，lastModified
oneFile //name,size,lastModified,lastModifiedDate,type
// 对象上的属性
// name 文件名
// size 文件大小
// lastModified 最后修改的时间
// lastModifiedDate 最后修改时间的 Date 对象
// type MIME类型
```

方法也只有一个，也是继承自 Blob

```js
Blob.slice(start, end ,contentType)
// start:分割起始点
// end: 分割终点
// contentType:新的MIME类型
```

### ArrayBuffer

内存上的一段二进制数据，可以通过 TypeArray、DataView 对它是先读写

Blob 与 ArrayBuffer 的关系

- ArrayBuffer是底层的二进制数据，可以借助工具进行读写，Blob是对底层数据的封装，拿到的是一个整体，你能看到大小，类型，但是不能看到细节。
- Blob可以接受一个ArrayBuffer作为参数生成的一个Blob对象，相当于ArrayBuffer的一个封装，之后就是整体展现了。

> Blob作为一个整体的文件，适合用于传输。只有关注文件的细节修改一部分的数据，才会用到ArrayBuffer。

### FileReader

FileReader可以将Blob、File读取为不同的格式。

FileReader.readAsDataURL(blob) 将数据转化为Base64

FileReader.readAsText(blob)将二进制数据读取并编码为字符串形式



### FormData

异步上传二进制文件

### 对象的互相转换

```js
// file 转换为 Blob
let aBlob = new Blob([file],{type:file.type})
// Blob 转化为 File
let oneFile = new window.File([Blob])
// File/Blob转化为 base64
function toDataURL(blob,callBack){
  let a = new FileReader()
  a.onload = function (e){callback(e.target.result)}
  a.readAsDataURL(blob)
}
```

URL 转化为 base64

```js
function transURL(url){
  let image = new Image()
  image.src = url
}
```

## 参考文章

| 作者            | 连接                                       |
| --------------- | ------------------------------------------ |
| controZL        | https://juejin.cn/post/6915795898609975309 |
| 阿宝哥          | https://juejin.cn/post/6980142557066067982 |
| 你不知道的 Blob | http://caibaojian.com/blob.html            |
|                 |                                            |
|                 |                                            |

