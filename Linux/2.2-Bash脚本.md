> Create by **fall** on 2022-11-22
> Recently revised in 2022-12-04

# Bash

> A Unix shell is both a command interpreter and a programming language.
>
> Unix shell 既是命令解释器，也是编程语言。

所有用于解析用户命令，并交给操作系统执行的应用程序，都可以称之为 shell。它有如下特点：

- 简单，体积小。换个角度看，就是低级，不方便。
- Unix / Linux 内置，几乎没有环境依赖。
- 擅长系统操作密集任务，无法胜任计算密集的任务。

操作系统中最常见的 shell

- `/bin/sh`：一个老牌 shell，一般情况下，也是系统的默认 shell。
- `/bin/bash`: 在 sh 的基础上增加了一些实用特性，是使用最广泛的 shell。（`git bash`）

## 使用

比如，可以用于书写批量执行的脚本，或者是 `npm` 中的脚本（node_modules 下的 `.bin` 目录中，有三类脚本）

首行内容固定，以 `#!` 开始，称为 shebang 指令，用于指定运行该脚本的解析器。

命名一个 bash 脚本：`hello.sh`，并在脚本内填写以下内容

```bash
#!/bin/sh
VAR="world"
echo "Hello $VAR"
```

```bash
$ bash hello.sh
```

输出内容为：`Hello world`

### 注释

```bash
# 这是一个内联 Bash 注释
# 多行注释中冒号，空格，引号，缺一不可。
: '
这是 bash 多行注释
bash echo
'
```

## 声明变量

```bash
NAME="Fall"     # 注意：赋值符号前后均不能有空格
echo ${NAME}    # => Fall (变量)
echo $NAME      # => Fall (变量)
echo "$NAME"    # => John (变量)
echo '$NAME'    # => $NAME (字符串原样输出) 单引号和双引号不同
echo "${NAME}!" # => John! (变量)
```

### 默认参数

系统提供了一些默认参数提供调用

| 表示        | 描述                     |
| ----------- | ------------------------ |
| `$0`        | 脚本本身的名称           |
| `$1` … `$9` | 参数 1 ... 9             |
| `${10}`     | 位置参数 10              |
| `$#`        | 参数数量                 |
| `$$`        | shell 的进程 id          |
| `$*`        | 所有参数                 |
| `$@`        | 所有参数，从第一个开始   |
| `$-`        | 当前选项                 |
| `$_`        | 上一个命令的最后一个参数 |

假设有如下脚本 `test`

```bash
#!/bin/sh
pink="Ori ddd"
echo $pink
echo $(pwd)
echo $0
echo $1
echo $*
```

我们通过该方式执行

```bash
# 执行该命令
bash test -g -m
# 得到输出为
# Ori ddd
# /e/Full-stuck-study/命令行
# test.sh
# -g
# -g -m
```

### 参数扩展

| 代码              | 描述             |
| ----------------- | ---------------- |
| `${FOO%suffix}`   | 删除后缀         |
| `${FOO#prefix}`   | 删除前缀         |
| `${FOO%%suffix}`  | 去掉长后缀       |
| `${FOO##prefix}`  | 删除长前缀       |
| `${FOO/from/to}`  | 替换第一个匹配项 |
| `${FOO//from/to}` | 全部替换         |
| `${FOO/%from/to}` | 替换后缀         |
| `${FOO/#from/to}` | 替换前缀         |



| 表示            | 描述                |
| --------------- | ------------------- |
| `${FOO:0:3}`    | 子串 *(位置，长度)* |
| `${FOO:(-3):3}` | 从右边开始的子串    |



## 函数

定义函数

```bash
#!/bin/sh
pink="Ori"
get_name() {
  echo "John ${pink}"
}
echo "You are $(get_name)"
# 执行结果
# You are John 执行结果 
```

其中，函数的定义也可以写为

```bash
function get_name(){
	echo "John $pink"
}
# 函数的执行必须通过 $() 或者 `` 进行包裹
$(get_name)
`get_name`
# 二者等价
```

## 命令替换

```bash
#!/bin/sh
# 如果想要执行一些命令，可以使用 `command` $(command) 使用命令 command 可替换
echo `pwd` # 等同于 $(pwd)
# 输出：
# /e/Full-stuck-study/命令行
echo "where am i $(pwd)"
echo "where am i `pwd`"
```

### 条件句

```bash
#!/bin/sh
string="wtf"
# string="" # 为空时，也为 false
if [ -z "$string" ]; then
    echo "String is empty"
elif [ -n "$string" ]; then
    echo "String is not empty"
fi
```

见：[条件句](#bash-条件句)

## 大括号扩展

```shell
echo {A,B}
# A B
echo {A,B}.js
# A.js B.js
{1..5}
# 1 2 3 4 5
{A..F}
# A B C D E F
```

### 语法子字符串Length

| 表示      | 描述          |
| --------- | ------------- |
| `${#FOO}` | `$FOO` 的长度 |

#### 默认值

| 表示              | 描述                                 |
| ----------------- | ------------------------------------ |
| `${FOO:-val}`     | `$FOO`，如果未设置，则为 `val`       |
| `${FOO:=val}`     | 如果未设置，则将 `$FOO` 设置为 `val` |
| `${FOO:+val}`     | `val` 如果设置了`$FOO`               |
| `${FOO:?message}` | 如果 `$FOO` 未设置，则显示消息并退出 |


## 参考文章

| 作者       | 链接                                                         |
| ---------- | ------------------------------------------------------------ |
| jaywcjlove | https://github.com/jaywcjlove/reference/blob/main/docs/bash.md |
| czpcalm    | https://juejin.cn/post/7130983293347954718                   |
|            |                                                              |

