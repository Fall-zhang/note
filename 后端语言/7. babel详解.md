## babel的包

### @babel/core

对代码进行转换的一些核心方法，官网的一句话“所有转换将使用本地配置文件” (babel.config.js)之前版本是babelrc.

core 就是核心的意思嘛

### @babel/cli

babel 带有的内置cli，让我们从命令行编译我们的命令

```bash
npm install --save-dev @babel/cli
# 进行安装 babel/cli 
npm babel study.js --watch --out-file study-compiled.js 
# 监听 study.js 并且监听生成 study-compiled.js
# --out-file把编译后的目标文件输出到相应的文件，每次更改目标时都进行编译可以加上 --watch
# 如果更改了配置，需要再次执行上面的文件，不然babel读取不到最新的命令
```

### @bebel/plugin* 和@babel/preset-env

这两个模块是 babel 配置的主要模块

**babel/plugin***

配置文件中配置所需的插件，配置上之后才能使用，当然，使用前先 install 插件

```js
// babel.config.js
module.exports ={
  presets:[],
  plugins:[
    "@babel/plugin-transform-arrow-functions",// 引入转换箭头函数的插件
    "@babel/plugin-transform-exponentiation-operator"// 引入转换引入新增的指数运算符
  ] 
}
// study.js
const exp = 2 ** 3
const study = ()=>{}
// study-compiled.js
const study = function(){}
const exponentiation = Math.pow(2,2)
```

这就是一个简单的 babel.config.js 配置文件的使用

但是这样一个一个引入太过于麻烦，所以有了另外一个插件，@babel/preset-env

**@babel/preset-env**

presets 是预设的意思，预先设定好引入一系列的东西，省的我们一个个的引入，官方提供了很多的 presets，比如 preset-env (处理es6+规范语法的集合)、preset-stage(一些尚在提议阶段的语法插件集合，当然在babel7+以上就被废除了)，preset-react(处理react的插件等等)。

```js
// babel.config.js 文件
module.exports ={
  presets:[
    "@babel/preset-env"
  ],plugins:[]
}
// 此时es6+的语法都被编译了，但新增的API方法并没有被编译，之后在 polyfill 的时候再治解决他。
```

在此基础上，还可以进行其他配置，比如说，添加一个 target ，指定作用的运行环境

```js
module.exports = {
  presets: [
    [
      "@babel/preset-env", {
        'targets': {'browsers': ['ie >= 8', 'iOS 7']} // 支持ie8，直接使用iOS浏览器版本7
      }]],
  plugins: []
}
```

babel 的 Browserslist 集成还支持在 package.json 文件里或者新建一个 .browserslistrc 文件来指定对应目标环境。

还有一个preset叫做babel/preset-dev 会根据浏览器和运行环境，自动确定babel插件和 polyfills

### @babel/polyfill

babel/polyfill 是由 core-js2和 regenerator-runtime 组成的一个集团包

因为比如 `Promise` 这类的API，babel 没有给转译，因为 babel 只会默认转译 js 语法，而不是整个API。当使用这些API时，只需在文件顶部引入就可以使用新增的 API 了

引入：`import '@babel/polyfill'` ，然后就可以使用新增的API了

这样引入会直接引入所有的包，如果想要引入相应的 polyfill 此时就应该使用下面的设置

```js
module.exports = {
  presets: [
    [
      "@babel/preset-env", {
        "modules": false,
        "useBuiltIns": "entry", 
        // 该属性用来按需引入 polyfill,只会把下面版本以上，不支持该api的polify引入
        'targets': {
          'browsers': ['ie >= 8', 'iOS 7'] // 支持ie8，直接使用iOS浏览器版本7
        }
      }
    ]
  ],
  plugins: []
}
```

**useBuiltIns**

选项："usage"|"entry"|false，默认为 false

`entry` 的意思是在入口，根据我们配置的浏览器进行浏览器兼容，将目标环境所有不支持的 API 都引入。

`usage` 配置为 usage 后，babel 会扫描你的每一个文件，然后检测都使用了那些新的 API，跟进配置兼容，只引入相应的 API 的 polyfilll。

> 使用`usage`这个选项的时候，命令行可能报了一堆警告，意思是你没有指定版本，会默认使用 2.x版本
>
> > WARNING: We noticed you're using the `useBuiltIns` option  without declaring a core-js version. Currently, we assume version 2.x  when no version is passed. Since this default version will likely change in future versions of Babel, we recommend explicitly setting the  core-js version you are using via the `corejs` option.
>
> 由于 babel/polyfill 是集成包，core-js3已经发布了，而且很稳定。core-js2在2018年后不维护了，@babel/polyfill 默认引入的是 core-js2。在 babel7.4.0 已经**不推荐使用 @babel/polyfill**了。
>
> 所以core-js官方现在推荐我们使用polyfill的时候直接引入 core-js 和 regenerator-runtime/runtime 这两个包完全取代 **@babel/polyfil** 来为了防止重大更改。

```js
module.export ={
  preset:[
    [
      "@babel/preset-env",{
       "modules":false,
        "useBuiltIns":"entry", // 意思是在入口根据配置的浏览器进行兼容，将目标不支持的API都引入
        "corejs":"3",
        "targets":{'browers':['not ie>=8','iOS 7']}
      }
    ]
  ],
  plugins:[]
}
```

### @babel/runtime

需要依赖` @babel/helpers` 和 `regenerator-runtime`

有时，语法的转换有些复杂，需要引入一些 `helper` 函数，比如说对 ES6 的 class 进行转换

```js
/* study.js */
class Test {}

/* study-compiled.js */
function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
var Test = function Test() {
  _classCallCheck(this, Test);
};
```

上面通过引入函数的方法来处理 class 的转换，但是有的方法很复杂，每个文件都会定义一遍这些个函数，每个文件的代码会很多。所以能否将这些代码抽到一个公文包里面。只需要引入对应的函数，降低代码量，此时就可以使用 `babel/plugin-transform-runtime` 插件来配合使用。在插件选项中加入这个插件。

> bebel 配置的注意事项：
>
> 在更改配置之后，一定要重启命令，否则不会生效。
>
> 维护一些公共组件库，或者一些别的公共库推荐要使用 `@babel/runtime` 配合 `babel/plugin-transform-runtime` 来建立沙箱环境

## babel的配置

配置分为两种，一种是preset，另一种是plugins

preset：包含了插件的所有功能



执行时的顺序

- 执行plugin中的所有插件
- plugin中的插件，按照引入的顺序进行编译
- 所有plugins中的插件引入完成，再执行presets预设
- presets预设，按照倒序进行执行。