# node.js

> node.js官方网站   https://nodejs.org
>
> node.js中文网       http://nodejs.cn

## node.js简介

> node.js是一个使用JavaScript语言，基于Chrome V8 引擎构建的开发平台
>
> 其它JS引擎
>
> - Firefox有`SpiderMonkey`
> - safari具有`JavaScriptCore`(又称为`Nitro`)
> - Edge有`Chakra`
>
> 所有这些引擎都实现了ECMA ES-262标准(ECMAScript)
>
> V8使用C++编写，通常被认为是一门解释型语言，但是现代的 JavaScript 不再是解释JavaScript，也会对其进行编译。JavaScript 是由V8在其内部编译的，使用了即时编译以加快执行速度。
>
> 可以开发控制台程序(命令行程序、CLI程序)，桌面应用程序(GUI)(借助 `node-webkit`、`electron`等框架)、web应用程序
>
> **node.js 的特性**
>
> - 事件驱动（事件出发时，执行并传递过去的回调函数）
> - 非阻塞I/O模型（IO操作时不会阻塞线程）
> - 单线程
> - 拥有世界最大的开源库生态系统----`npm`

> **网站开发技术栈**
>
> PHP开发技术栈：LAMP - Linux Apache MySQL PHP
>
> node.js 全栈开发技术栈：MEAN - MongoDB Express Angular Node.js
>
> **Web开发的本质**
>
> - 请求：客户端发起请求
> - 处理：服务器处理请求
> - 响应：服务器将处理结果发送到客户端

### node开发的不同

> node.js 开发web应用程序和PHP、Java、ASP.Net等传统开发Web应用程序的区别在于，传统模式必须有Web容器(比如说apache服务器)
>

**使用node.js开发的优点**

- 提供好的基础和包管理工具
- 测试相关 tdd / bdd 测试覆盖率
- 规范化 standard、各种 lint、hint
- 构建相关 gulp、grunt、webpack，大量插件
- 生成器 yo 等
- 包管理工具 npm 足够简单易用

## REPL介绍

Read-Eval-Print-Loop(交互式解释器)

- Read：读取 - 读取用户输入，解析输入JavaScript的数据的数据结构并存储在内存中
- Eval：执行 - 之行输入的数据结构
- Print：打印 - 打印输出结果
- Loop：循环 - 循环操作以上步骤，直到用户按两下`ctrl + c`退出

**基本使用方法**

- 直接在REPL中写程序进行测试，在命令行工具输入`node`可以进入REPL环境
- 运行node.js脚本，`node app.js`
- 可以使用` process.exit(1)`或者简写 `.exit`退出REPL界面

### REPL其他功能

> **tab自动补全**：在输入一部分命令之后，可以使用tab键自动补全
>
> **探索JavaScript对象**：输入完一个对象(`Number.`)之后，通过tab键可以打印可访问的所有属性和方法
>
> **探索全局对象**：`global.` 再按下tab键。
>
> **`_`特殊变量**：如果在某些代码之后输入`_`会打印最后一次操作结果。

**点命令**

> - `.help`：显示点命令的帮助
> - `.editor`：启用编辑器模式，可以轻松地编写多行JavaScript代码
> - `.break`：输入多行的表达式时，输入`.break` 命令可以终止进一步的操作
> - `.clear` ：将REPL上下文重置为空对象并清除当前正在输入的任何多行的表达式
> - `.load` ：加载JavaScript文件(相对于当前工作目录)
> - `.save` ：将在REPL绘画中输入的所有内容保存到文件(需指定文件名)
> - `.exit` ：退出REPL，相当于按下两次`ctrl+C`

## 编写程序

配置代码缩进为两个空格

**JavaScript 文件命名规则**

> - 不要用中文
> - 不要包含空格
> - 不要出现node关键字，比如不能命名为node.js。
> - 用'-' 划分单词

**输出到命令行**

`console.log('我的%s已经%d岁', '猫', 2)`

> - `%s` 会格式化变量为字符串
> - `%d` 会格式化变量为数字
> - `%i` 会格式化变量为其整数部分
> - `%o` 会格式化变量为对象

**计算耗时**

> 利用`console.time()` 和 `console.timeEnd()` 计算执行某个函数的耗时

**stdout和stderr**

> console.log 非常适合在控制台中打印消息。 这就是所谓的标准输出（或称为 `stdout`）。
>
> `console.error` 会打印到 `stderr` 流。
>
> 它不会出现在控制台中，但是会出现在错误日志中。

## node的模块

node模块分为全局模块和非全局模块

> 引入模块： `const library = require('./library') ` 
>
> 可以导入存在当前文件夹中的 library.js 中公开的功能。必须公开其功能，其他文件才能将它导入。
>
> 每个独立的文件遵循commonJS规范，对象和变量都是私有的，不会公开给外界。由 module

process 模块在使用的时候，无需通过require()函数来加载该模块，可以直接使用

fs(file system) 模块，必须通过require()函数加载该模块

> process 模块是全局模块，fs是非全局模块，需要加载才能使用

## 事件循环

事件循环阐明了 Node.js 如何做到异步且具有非阻塞的 I/O 

JavaScript 代码运行在单个线程上，每次只处理一件事。简化了编程方式，不用考虑并发问题。

只要注意如何编写代码，并且避免任何可能阻塞线程的事情，例如同步的调用或无限的循环，

大多数浏览器中，每个浏览器选项卡都有一个事件循环，使每个进程都隔开，避免一个网页繁重的处理影响到整个浏览器的网页。

### 阻塞事件循环

任何花费太长时间才能将控制权返回给事件循环的 JavaScript 代码，都会阻塞页面中任何 JavaScript 代码的执行，甚至阻塞 UI 线程，并且用户无法单击浏览、滚动页面等。

JavaScript 中几乎所有的 I/O 基元都是非阻塞的。 网络请求、文件系统操作等。 被阻塞是个异常，这就是 JavaScript 如此之多基于回调（最近越来越多基于 promise 和 async/await）的原因。

> 总结：除 setTimeout 和异步操作外，其它函数执行完成之后，再开始执行计时器或者异步操作的函数