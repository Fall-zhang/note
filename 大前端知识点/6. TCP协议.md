> Create by **fall** on 2021-01-03
> Recently revised in 2021-10-02

好吧，TCP这个协议，比C++要复杂，所以提前需要知道一些知识，没问题吧？

> 我们需要知道TCP在网络OSI的七层模型中的第四层——Transport层，IP在第三层——Network层，ARP在第二层——Data Link层，在第二层上的数据，我们叫Frame，在第三层上的数据叫Packet，第四层的数据叫Segment。
>
> 我们程序的数据首先会打到TCP的Segment中，然后TCP的Segment会打到IP的Packet中，然后再打到以太网Ethernet的Frame中，传到对端后，各个层解析自己的协议，然后把数据交给更高层的协议处理。

## TCP的头格式

<img src="https://coolshell.cn/wp-content/uploads/2014/05/TCP-Header-01.jpg" style="zoom:80%;" >

- TCP的包，没有IP地址，TCP不负责该部分，但是，有源端口和目标端口。
- 一个TCP连接需要四个元组来表示是同一个连接（src_ip,src_port,dst_ip,dst_port），但是准确的来说，还需要一个协议。但协议不就是这个TCP吗。所以这里说是四个
- 投个始终有四个十分重要的东西
  - Sequence Number 是包的序列号，用来解决网络包乱序（recordering）问题
  - Acknowledgement Number 确认收到，用来解决不丢包的问题
  - Window 又叫 Advertised-Window 也就是著名的滑动窗口（Sliding Window），**用于解决流控的**。
  - TCP Flag，包的类型，用于操控TCP的状态机。

<img src="https://coolshell.cn/wp-content/uploads/2014/05/TCP-Header-02.jpg" style="zoom: 67%;">



## TCP的状态机

其实，**网络上的传输是没有连接的，包括TCP也是一样的**。而TCP所谓的“连接”，其实只不过是在通讯的双方维护一个“连接状态”，让它看上去好像有连接一样。所以，TCP的状态变换是非常重要的。











## 参考文章

| 作者 | 链接                                     |
| ---- | ---------------------------------------- |
| 陈皓 | https://coolshell.cn/articles/11564.html |
|      |                                          |
|      |                                          |

